# Migration `20210617122528-update_to_schedule`

This migration has been generated by Jussi at 6/17/2021, 3:25:28 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "transaction_recurrences" DROP CONSTRAINT "transaction_recurrences_category_id_fkey"

ALTER TABLE "transaction_recurrences" DROP CONSTRAINT "transaction_recurrences_uid_fkey"

ALTER TABLE "transactions" DROP CONSTRAINT "transactions_recurrence_id_fkey"

ALTER TABLE "transactions" DROP COLUMN "recurrence_id",
ADD COLUMN     "schedule_id" TEXT

CREATE TABLE "transaction_schedules" (
    "id" TEXT NOT NULL,
    "uid" TEXT NOT NULL,
    "category_id" TEXT NOT NULL,
    "comment" TEXT,
    "integer_amount" INTEGER NOT NULL,
    "interval_type" "IntervalType" NOT NULL,
    "interval_length" INTEGER NOT NULL,
    "first_occurrence" TIMESTAMP(3) NOT NULL,
    "last_occurrence" TIMESTAMP(3),
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("id")
)

DROP TABLE "transaction_recurrences"

ALTER TABLE "transaction_schedules" ADD FOREIGN KEY("uid")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "transaction_schedules" ADD FOREIGN KEY("category_id")REFERENCES "categories"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "transactions" ADD FOREIGN KEY("schedule_id")REFERENCES "transaction_schedules"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210617095515-update_transaction_recurrence..20210617122528-update_to_schedule
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id               String   @id @default(uuid())
@@ -19,15 +19,15 @@
   createdAt        DateTime @default(now()) @map("created_at")
   updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")
   stripeCustomerId String?  @map("stripe_customer_id")
-  Transactions           Transaction[]
-  Categories             Category[]
-  Budgets                Budget[]
-  Feedback               Feedback[]
-  Profile                Profile?
-  Log                    Log[]
-  TransactionRecurrences TransactionRecurrence[]
+  Transactions        Transaction[]
+  Categories          Category[]
+  Budgets             Budget[]
+  Feedback            Feedback[]
+  Profile             Profile?
+  Log                 Log[]
+  TransactionSchedule TransactionSchedule[]
   @@map(name: "users")
 }
@@ -52,35 +52,36 @@
   integerAmount Int      @map("integer_amount")
   time          DateTime
   createdAt     DateTime @default(now()) @map("created_at")
   updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")
-  recurrenceId  String?  @map("recurrence_id")
+  scheduleId    String?  @map("schedule_id")
-  User       User                   @relation(fields: [uid], references: [id])
-  Category   Category               @relation(fields: [categoryId], references: [id])
-  Recurrence TransactionRecurrence? @relation(fields: [recurrenceId], references: [id])
+  User     User                 @relation(fields: [uid], references: [id])
+  Category Category             @relation(fields: [categoryId], references: [id])
+  Schedule TransactionSchedule? @relation(fields: [scheduleId], references: [id])
   @@map(name: "transactions")
 }
-model TransactionRecurrence {
-  id             String       @id @default(uuid())
-  uid            String
-  categoryId     String       @map("category_id")
-  comment        String?
-  integerAmount  Int          @map("integer_amount")
-  intervalType   IntervalType @map("interval_type")
-  intervalLength Int          @map("interval_length")
-  firstOccurence DateTime     @map("first_occurence")
-  lastOccurence  DateTime?    @map("last_occurence")
-  createdAt      DateTime     @default(now()) @map("created_at")
-  updatedAt      DateTime     @default(now()) @updatedAt @map("updated_at")
+model TransactionSchedule {
+  id              String       @id @default(uuid())
+  uid             String
+  categoryId      String       @map("category_id")
+  comment         String?
+  integerAmount   Int          @map("integer_amount")
+  intervalType    IntervalType @map("interval_type")
+  intervalLength  Int          @map("interval_length")
+  firstOccurrence DateTime     @map("first_occurrence")
+  lastOccurrence  DateTime?    @map("last_occurrence")
+  createdAt DateTime @default(now()) @map("created_at")
+  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
+
   User        User          @relation(fields: [uid], references: [id])
   Category    Category      @relation(fields: [categoryId], references: [id])
   Transaction Transaction[]
-  @@map(name: "transaction_recurrences")
+  @@map(name: "transaction_schedules")
 }
 enum IntervalType {
   DAY
@@ -124,9 +125,9 @@
   updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
   Transactions             Transaction[]
   BudgetCategoryInclusions BudgetCategoryInclusion[]
-  TransactionRecurrence    TransactionRecurrence[]
+  TransactionSchedule      TransactionSchedule[]
   User User @relation(fields: [uid], references: [id])
   @@unique([uid, value], name: "unique_uid_value")
```


