# Migration `20210617095515-update_transaction_recurrence`

This migration has been generated by Jussi at 6/17/2021, 12:55:15 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."IntervalType" AS ENUM ('DAY', 'WEEK', 'MONTH', 'YEAR')

ALTER TABLE "transaction_recurrences" ADD COLUMN     "interval_type" "IntervalType" NOT NULL,
ADD COLUMN     "interval_length" INTEGER NOT NULL,
ADD COLUMN     "first_occurence" TIMESTAMP(3) NOT NULL,
ADD COLUMN     "last_occurence" TIMESTAMP(3)

ALTER TABLE "transactions" ADD COLUMN     "recurrence_id" TEXT

ALTER TABLE "transactions" ADD FOREIGN KEY("recurrence_id")REFERENCES "transaction_recurrences"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210617075338-add_transaction_recurrences..20210617095515-update_transaction_recurrence
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id               String   @id @default(uuid())
@@ -19,15 +19,15 @@
   createdAt        DateTime @default(now()) @map("created_at")
   updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")
   stripeCustomerId String?  @map("stripe_customer_id")
-  Transactions          Transaction[]
-  Categories            Category[]
-  Budgets               Budget[]
-  Feedback              Feedback[]
-  Profile               Profile?
-  Log                   Log[]
-  TransactionRecurrence TransactionRecurrence[]
+  Transactions           Transaction[]
+  Categories             Category[]
+  Budgets                Budget[]
+  Feedback               Feedback[]
+  Profile                Profile?
+  Log                    Log[]
+  TransactionRecurrences TransactionRecurrence[]
   @@map(name: "users")
 }
@@ -39,8 +39,9 @@
   themeColor     String? @map("theme_color")
   themeMode      String? @map("theme_mode")
   User User @relation(fields: [uid], references: [id])
+
   @@map(name: "profiles")
 }
 model Transaction {
@@ -51,30 +52,44 @@
   integerAmount Int      @map("integer_amount")
   time          DateTime
   createdAt     DateTime @default(now()) @map("created_at")
   updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")
+  recurrenceId  String?  @map("recurrence_id")
-  User     User     @relation(fields: [uid], references: [id])
-  Category Category @relation(fields: [categoryId], references: [id])
+  User       User                   @relation(fields: [uid], references: [id])
+  Category   Category               @relation(fields: [categoryId], references: [id])
+  Recurrence TransactionRecurrence? @relation(fields: [recurrenceId], references: [id])
   @@map(name: "transactions")
 }
 model TransactionRecurrence {
-  id            String   @id @default(uuid())
-  uid           String
-  categoryId    String   @map("category_id")
-  comment       String?
-  integerAmount Int      @map("integer_amount")
-  createdAt     DateTime @default(now()) @map("created_at")
-  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")
+  id             String       @id @default(uuid())
+  uid            String
+  categoryId     String       @map("category_id")
+  comment        String?
+  integerAmount  Int          @map("integer_amount")
+  intervalType   IntervalType @map("interval_type")
+  intervalLength Int          @map("interval_length")
+  firstOccurence DateTime     @map("first_occurence")
+  lastOccurence  DateTime?    @map("last_occurence")
+  createdAt      DateTime     @default(now()) @map("created_at")
+  updatedAt      DateTime     @default(now()) @updatedAt @map("updated_at")
-  User     User     @relation(fields: [uid], references: [id])
-  Category Category @relation(fields: [categoryId], references: [id])
+  User        User          @relation(fields: [uid], references: [id])
+  Category    Category      @relation(fields: [categoryId], references: [id])
+  Transaction Transaction[]
   @@map(name: "transaction_recurrences")
 }
+enum IntervalType {
+  DAY
+  WEEK
+  MONTH
+  YEAR
+}
+
 model Budget {
   id            String   @id @default(uuid())
   uid           String
   label         String?
```


