# Migration `20210618064243-updates`

This migration has been generated by Jussi at 6/18/2021, 9:42:43 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "profiles" ADD COLUMN     "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN     "updated_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP

ALTER TABLE "transaction_schedules" DROP COLUMN "last_occurrence",
ADD COLUMN     "occurrences" INTEGER NOT NULL
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210617122528-update_to_schedule..20210618064243-updates
--- datamodel.dml
+++ datamodel.dml
@@ -3,23 +3,28 @@
 }
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
+// Each user is connected to a user account, which contains their ID, login
+// details and other authentication details. The user account may also specify
+// the user's google account and stripe customer ID. All other user data is
+// linked back to the user object with a UID field. Each user is also connected
+// to a profile.
 model User {
   id               String   @id @default(uuid())
   email            String?  @unique
   emailVerified    Boolean  @default(false) @map("email_verified")
   password         String?
-  googleId         String?  @unique @map("google_id")
   tokenVersion     Int      @default(1) @map("token_version")
   disabled         Boolean  @default(false)
   isAdmin          Boolean  @default(false) @map("is_admin")
+  googleId         String?  @unique @map("google_id")
+  stripeCustomerId String?  @map("stripe_customer_id")
   createdAt        DateTime @default(now()) @map("created_at")
   updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")
-  stripeCustomerId String?  @map("stripe_customer_id")
   Transactions        Transaction[]
   Categories          Category[]
   Budgets             Budget[]
@@ -30,21 +35,28 @@
   @@map(name: "users")
 }
+// Profile contains public user data such as the user's id, name, photo,
+// optional google photo and settings.
 model Profile {
-  uid            String  @id
-  displayName    String? @map("display_name")
-  photoUrl       String? @map("photo_url")
-  googlePhotoUrl String? @map("google_photo_url")
-  themeColor     String? @map("theme_color")
-  themeMode      String? @map("theme_mode")
+  uid            String   @id
+  displayName    String?  @map("display_name")
+  photoUrl       String?  @map("photo_url")
+  googlePhotoUrl String?  @map("google_photo_url")
+  themeColor     String?  @map("theme_color")
+  themeMode      String?  @map("theme_mode")
+  createdAt      DateTime @default(now()) @map("created_at")
+  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at")
   User User @relation(fields: [uid], references: [id])
   @@map(name: "profiles")
 }
+// Transactions contain all incomes and expenses and other details. All
+// transactions belong to a category and a user and may optionally specify
+// that they belong to a specific transaction schedule.
 model Transaction {
   id            String   @id @default(uuid())
   uid           String
   categoryId    String   @map("category_id")
@@ -61,8 +73,12 @@
   @@map(name: "transactions")
 }
+// All transaction schedules specify template data for creating transactions
+// and the intervalType, intervalLength, firstOccurrence and occurrences
+// fields that model when transactions according to the template should be
+// created.
 model TransactionSchedule {
   id              String       @id @default(uuid())
   uid             String
   categoryId      String       @map("category_id")
@@ -70,27 +86,30 @@
   integerAmount   Int          @map("integer_amount")
   intervalType    IntervalType @map("interval_type")
   intervalLength  Int          @map("interval_length")
   firstOccurrence DateTime     @map("first_occurrence")
-  lastOccurrence  DateTime?    @map("last_occurrence")
+  occurrences     Int
+  createdAt       DateTime     @default(now()) @map("created_at")
+  updatedAt       DateTime     @default(now()) @updatedAt @map("updated_at")
-  createdAt DateTime @default(now()) @map("created_at")
-  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
-
   User        User          @relation(fields: [uid], references: [id])
   Category    Category      @relation(fields: [categoryId], references: [id])
   Transaction Transaction[]
   @@map(name: "transaction_schedules")
 }
+// Possible interval types for transaction schedules
 enum IntervalType {
   DAY
   WEEK
   MONTH
   YEAR
 }
+// All budgets are used to analyze transactions and measure if their sum
+// exceed the set limit in integerAmount. A budget only measures transactions
+// that belong to categories specified by the budget category inclusiosn field.
 model Budget {
   id            String   @id @default(uuid())
   uid           String
   label         String?
@@ -105,8 +124,9 @@
   @@map(name: "budgets")
 }
+// Intermediate table for manually connecting budgets to categories.
 model BudgetCategoryInclusion {
   budgetId   String @map("budget_id")
   categoryId String @map("category_id")
@@ -115,8 +135,11 @@
   @@id([categoryId, budgetId])
 }
+// Categories contain their name in the value field, an optional icon and
+// metadata. All transactions belong to a category and categories are linked
+// to budgets with budget category inclusions.
 model Category {
   id        String   @id @default(uuid())
   uid       String
   value     String
@@ -134,16 +157,19 @@
   @@unique([uid, id], name: "unique_uid_id")
   @@map(name: "categories")
 }
+// All simple feedback items include the user who left the message and the
+// feedback message itself.
 model Feedback {
   id      String  @id @default(uuid())
   uid     String
   message String?
   User User @relation(fields: [uid], references: [id])
 }
+// Shape of logs that are saved to the database.
 model Log {
   id         String   @id @default(uuid())
   uid        String?
   type       String
@@ -158,8 +184,10 @@
   User User? @relation(fields: [uid], references: [id])
 }
+// All configuration values are string key-value pairs that are further
+// processed on the server.
 model Config {
   key   String @id
   value String
 }
```


